<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>選擇題練習</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f4f4f4;
        }
        .year-button {
            margin: 5px; /* 按鈕間隔設定為5px，您可以根據需要調整 */
        }
        .quiz-container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .question {
            font-size: 1.2em;
            margin-bottom: 20px;
            margin-top: 20px; /* 增加上邊距 */
        }
        .choices {
            list-style-type: none;
            padding: 0;
        }
        .choice {
            margin-bottom: 10px;
        }
        .result {
            margin-top: 20px;
            font-size: 1.2em;
        }
        .subject-selection {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .subject-selection button {
            margin: 10px 0;
        }
        .subject-name {
            font-size: 1.5em;
            text-align: center;
            margin-bottom: 20px;
        }
        #question-count {
            margin-bottom: 20px; /* 增加下邊距 */
        }
    </style>
</head>
<body>
    <div class="quiz-container" id="subject-container">
        <div class="subject-selection">
            <h2>請選擇練習的科目：</h2>
            <button onclick="loadSubjectForTest('testquestions')">測試</button>
            <button onclick="loadSubject('GenLawI_CAIP')">綜合法學(一) （憲法、行政法、國際公法、國際私法）</button>
            <button onclick="loadSubject('GenLawI_CCE')">綜合法學(一) （刑法、刑事訴訟法、法律倫理）</button>
            <button onclick="loadSubject('GenLawII_CP')">綜合法學(二) （民法、民事訴訟法）</button>
            <button onclick="loadSubject('GenLawII_CIBSE')">綜合法學(二) （公司法、保險法、票據法、證券交易法、強制執行法、法學英文）</button>
            <!-- 可以根據需要添加更多科目 -->
        </div>
    </div>

    <div class="quiz-container" id="year-container" style="display: none;">
        <div class="year-selection">
            <h2>請選擇年份：</h2>
            <!-- 年份按鈕將動態生成 -->
        </div>
    </div>

    <div class="quiz-container" id="quiz-container" style="display: none;">
        <div id="subject-name" class="subject-name">科目名稱</div>
        <div id="question-count">題數：0 / 0</div>
        <div class="question" id="question">這裡是題目內容，請選擇一個答案：</div>
        <ul class="choices" id="choices">
            <!-- 選項會由JavaScript動態生成 -->
        </ul>
        <button id="submit" onclick="checkAnswer()">提交答案</button>
        <div class="result" id="result"></div>
        <button id="nextBtn" style="display: none;" onclick="loadNextQuestion()">下一題</button>
    </div>

    <script>
        let questions = [];
        let currentQuestionIndex = 0;
        let selectedSubject = '';
        const years = ['108', '109']; // 可用年份

        const subjectNames = {
            "testquestions": "測試",
            "GenLawI_CAIP": "綜合法學(一) （憲法、行政法、國際公法、國際私法）",
            "GenLawI_CCE": "綜合法學(一) （刑法、刑事訴訟法、法律倫理）",
            "GenLawII_CP": "綜合法學(二) （民法、民事訴訟法）",
            "GenLawII_CIBSE": "綜合法學(二) （公司法、保險法、票據法、證券交易法、強制執行法、法學英文）",
            // 可以根據需要添加更多科目
        };

        function loadSubjectForTest(subject) {
            fetch(`question/${subject}.json`)
                .then(response => response.json())
                .then(data => {
                    questions = data;
                    shuffleArray(questions); // 洗牌
                    currentQuestionIndex = 0;
                    document.getElementById('subject-container').style.display = 'none';
                    document.getElementById('quiz-container').style.display = 'block';
                    // 使用映射表來獲取友好的科目名稱
                    const friendlyName = subjectNames[subject] || "未知科目"; // 如果找不到對應的名稱，則顯示"未知科目"
                    document.getElementById('subject-name').textContent = friendlyName; // 設定科目名稱
                    document.getElementById('question-count').textContent = `題數：${currentQuestionIndex + 1} / ${questions.length}`;
                    loadQuestion();
                })
                .catch(error => console.error('Error loading questions:', error));
        }

        function loadSubject(subject) {
            selectedSubject = subject; // 儲存選擇的科目
            document.getElementById('subject-container').style.display = 'none';
            document.getElementById('year-container').style.display = 'block';
            generateYearButtons(); // 生成年份按鈕
        }

        function generateYearButtons() {
            const container = document.querySelector('.year-selection');
            years.forEach(year => {
                const button = document.createElement('button');
                button.textContent = year + '年';
                button.className = 'year-button'; // 為按鈕添加新的CSS類別
                button.onclick = () => loadYearQuestions(year);
                container.appendChild(button);
            });
        }

        function loadYearQuestions(year) {
            const subjectFile = `${selectedSubject}_${year}.json`; // 根據選擇的科目和年份生成檔案名稱
            fetch(`question/${subjectFile}`)
                .then(response => response.json())
                .then(data => {
                    questions = data;
                    shuffleArray(questions); // 洗牌
                    currentQuestionIndex = 0;
                    document.getElementById('subject-container').style.display = 'none';
                    document.getElementById('quiz-container').style.display = 'block';
                    // 使用映射表來獲取友好的科目名稱
                    const friendlyName = subjectNames[selectedSubject] || "未知科目"; // 如果找不到對應的名稱，則顯示"未知科目"
                    document.getElementById('subject-name').textContent = `${year}年 ${friendlyName}`; // 在科目名稱前加上年份
                    document.getElementById('question-count').textContent = `題數：${currentQuestionIndex + 1} / ${questions.length}`;
                    loadQuestion();
                })
                .catch(error => console.error('Error loading questions:', error));
            document.getElementById('year-container').style.display = 'none';
            document.getElementById('quiz-container').style.display = 'block';
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function loadQuestion() {
            const resultElement = document.getElementById('result');
            resultElement.textContent = ''; // 清空結果訊息
            resultElement.style.color = ''; // 清空結果文字顏色

            if (questions.length > 0) {
                const questionData = questions[currentQuestionIndex];
                document.getElementById('question').textContent = questionData.question;
                const choicesContainer = document.getElementById('choices');
                choicesContainer.innerHTML = '';
                const optionLabels = ['(A) ', '(B) ', '(C) ', '(D) ']; // 新增選項標籤
                questionData.options.forEach((option, index) => {
                    const choiceItem = document.createElement('li');
                    choiceItem.className = 'choice';
                    choiceItem.innerHTML = `
                        <input type="radio" name="choice" value="${index}" id="choice${index}">
                        <label for="choice${index}">${optionLabels[index]}${option}</label>
                    `;
                    choicesContainer.appendChild(choiceItem);
                });
            } else {
                document.getElementById('question').textContent = '所有題目都已完成！';
                document.getElementById('choices').style.display = 'none';
                document.querySelector('button').style.display = 'none';
            }
        }

        function checkAnswer() {
            const questionData = questions[currentQuestionIndex];
            const correctAnswers = Array.isArray(questionData.answer_index) ? questionData.answer_index : [questionData.answer_index];
            const choices = document.getElementsByName('choice');
            let selectedValues = [];
            for (const choice of choices) {
                if (choice.checked) {
                    selectedValues.push(parseInt(choice.value, 10));
                }
            }
            const resultElement = document.getElementById('result');
            if (selectedValues.length > 0) {
                const isCorrect = selectedValues.some(selectedValue => correctAnswers.includes(selectedValue));
                if (isCorrect) {
                    resultElement.textContent = "恭喜你，答對了！";
                    resultElement.style.color = "green";
                    setTimeout(() => {
                        resultElement.textContent = ''; // 清空結果訊息
                        loadNextQuestion(); // 自動跳到下一題
                    }, 500); // 0.5 秒後自動跳到下一題
                } else {
                    const optionLabels = ['(A) ', '(B) ', '(C) ', '(D) ']; // 新增選項標籤
                    resultElement.textContent = "答錯了，正確答案是：" + correctAnswers.map(index => optionLabels[index] + questionData.options[index]).join(" 或 ");
                    resultElement.style.color = "red";
                    document.getElementById('nextBtn').style.display = 'block'; // 顯示下一題按鈕
                }
            } else {
                resultElement.textContent = "請選擇一個答案。";
                resultElement.style.color = "orange";
            }
        }

        function loadNextQuestion() {
            document.getElementById('nextBtn').style.display = 'none'; // 隱藏下一題按鈕
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                document.getElementById('question-count').textContent = `題數：${currentQuestionIndex + 1} / ${questions.length}`;
                loadQuestion();
            } else {
                document.getElementById('question').textContent = '所有題目都已完成！';
                document.getElementById('choices').style.display = 'none';
                document.getElementById('submit').style.display = 'none';
                setTimeout(() => {
                    location.reload();
                }, 500);
            }
        }
    </script>
</body>
</html>